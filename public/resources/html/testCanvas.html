<!DOCTYPE html>
<html>
   <head>
      <meta charset = "utf-8">
      <title>jQuery UI Widget - Default functionality</title>
      <link rel = "stylesheet" href = "//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
      <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
      <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
      <script src = "../../lib/js/jcanvas.min.js"></script>

      <script>
         $(function() {
        	 /**
            $.widget("iP.myButton", {
               _create: function() { 
                  this._button = $("<button>"); 
                  this._button.text("My first Widget Button");
                  this._button.width(this.options.width) 
                  this._button.css("background-color", this.options.color);    
                  this._button.css("position", "absolute");   
                  this._button.css("left", "100px");            
                  $(this.element).append(this._button);
               },
         
               move: function(dx) { 
                  var x = dx + parseInt(this._button.css("left")); 
                  this._button.css("left", x); 
                  if(x>400) { this._trigger("outbounds",{},  {position:x}); }
               }
            });
            $("#button3").myButton();
            $("#button3").myButton("move", 200);
            //$("#button3").myButton("disable");
                  
            
         $("canvas").drawPolygon({
          	  draggable: true,
          	  fillStyle: "#6c3",
          	  x: 100, y: 100,
          	  radius: 50, sides: 5,
          	  layer: true
          	});
         
			$('canvas').draw({
					fn : function(ctx) {
						ctx.fillStyle = '#333';
						ctx.fillRect(50, 50, 100, 100);
					},
					 layer: true
				});
			
        */        	

         drawTableLayer('canvas.canvas1', 0, 0, document.getElementById('canvas1').scrollWidth, document.getElementById('canvas1').scrollHeight);
         drawTableLayer('canvas.canvas2', 0, 0, document.getElementById('canvas2').scrollWidth, document.getElementById('canvas2').scrollHeight);
         drawTableLayer('canvas.canvas3', 0, 0, document.getElementById('canvas3').scrollWidth, document.getElementById('canvas3').scrollHeight);
         drawTableLayer('canvas.canvas4', 0, 0, document.getElementById('canvas4').scrollWidth, document.getElementById('canvas4').scrollHeight);
         drawTableLayer('canvas.canvas5', 0, 0, document.getElementById('canvas5').scrollWidth, document.getElementById('canvas5').scrollHeight);
         
         });
         
function drawTableLayer(canvasId, tableTopLeft_x, tableTopLeft_y, tableWidth, tableHeight) {
	drawTableLayer_Angle(canvasId, 0, 2.5*Math.PI, tableTopLeft_x, tableTopLeft_y, tableWidth, tableHeight);
}

function _createRadiusPoint(x, y, r) {
	return { 'x': x, 'y': y, 'r': r };
}

function ringTable_isDebuggingTable() {
	return false;
}
         
function drawTableLayer_Angle(canvasId, startAngle, stopAngle, tableTopLeft_x, tableTopLeft_y, tableWidth, tableHeight) {	

	var leftCenter=null, rightCenter=null, topCenter=null, bottomCenter=null;
	if (tableWidth > tableHeight) {
		var middle = tableHeight / 2;
		leftCenter  = _createRadiusPoint(tableTopLeft_x + middle, tableTopLeft_y + middle, middle);
		rightCenter = _createRadiusPoint(tableTopLeft_x + tableWidth - middle, tableTopLeft_y + middle, middle);
	} else if (tableWidth < tableHeight) {
		var middle = tableWidth / 2;
		topCenter    = _createRadiusPoint(tableTopLeft_x + middle, tableTopLeft_y + middle, middle);
		bottomCenter = _createRadiusPoint(tableTopLeft_x + middle, tableTopLeft_y + tableHeight - middle, middle);
	} else {
		// circle
		var middle = tableWidth / 2;
		leftCenter  = _createRadiusPoint(tableTopLeft_x + middle, tableTopLeft_y + middle, middle);
		rightCenter = _createRadiusPoint(tableTopLeft_x + tableWidth - middle, tableTopLeft_y + middle, middle);
		topCenter    = _createRadiusPoint(tableTopLeft_x + middle, tableTopLeft_y + middle, middle);
		bottomCenter = _createRadiusPoint(tableTopLeft_x + middle, tableTopLeft_y + tableHeight - middle, middle);
	}
	
	
	if (leftCenter != null) {
		ringTable_drawCurvedEnd(canvasId, leftCenter, startAngle, stopAngle, 0.5*Math.PI, 1.5*Math.PI);
	}
	if (rightCenter != null) {
		ringTable_drawCurvedEnd(canvasId, rightCenter, startAngle, stopAngle, 1.5*Math.PI, 2.5*Math.PI);
	}
	if (bottomCenter != null) {
		ringTable_drawCurvedEnd(canvasId, bottomCenter, startAngle, stopAngle, 0, Math.PI);
	}
	if (topCenter != null) {
		ringTable_drawCurvedEnd(canvasId, topCenter, startAngle, stopAngle, Math.PI, 2*Math.PI);
	}
	if (topCenter == null) { 
		ringTable_drawStraightSides(canvasId, leftCenter.x, tableTopLeft_y, rightCenter.x - leftCenter.x, tableHeight, true);
	}
	if (leftCenter == null) {
		ringTable_drawStraightSides(canvasId, tableTopLeft_x, topCenter.y, tableWidth, bottomCenter.y - topCenter.y, false);
	}
}


function _getValue(selector, property, defaulValue) {
	var val = $(selector).css(property);
	if (val == undefined) {
		val = defaulValue;
	}
	return val;
}

// This creates the gradient for the straight part of the rail cushion
// We expect layer to have a layer.data.isVertical, layer.data.canvasSelector
function linearFillCallback(layer) {

	var cushionPrimary = _getValue(layer.data.canvasSelector, 'cushionPrimary', '#000');
	var cushionFade = _getValue(layer.data.canvasSelector, 'cushionFade', 'rgba(255, 0, 0, 0.75)');
	
	var params = {
			c1: cushionFade,
			c2: cushionPrimary, s2: 0.2,
			c3: cushionPrimary, s3: 0.8,
			c4: cushionFade				
	};
	if (layer.data.isVertical) {
		params.x1 = layer.x - layer.width/2;
		params.x2 = layer.x + layer.width/2;
		params.y1 = layer.y;
		params.y2 = layer.y;
	} else {
		params.x1 = layer.x;
		params.x2 = layer.x;
		params.y1 = layer.y - layer.height/2;
		params.y2 = layer.y + layer.height/2;
	}
	return $(this).createGradient(params);
};

/**
 * Common parameters for sides.
 */
function _private_ringTable_createDrawStraightSides_Params(params) {
	params.layer = true;
	if (ringTable_isDebuggingTable()) {
		params.strokeStyle = '#000';
		params.strokeWidth = 2;
	} else {
		params.fillStyle = linearFillCallback;
	}
	
	return params;
}

/**
 * Draws the straight poritions of the rail/cushion which are simply rectangles.
 *
 *
 */
function ringTable_drawStraightSides(canvasId, topLeft_x, topLeft_y, theWidth, theHeight, isTopAndBottomRail) {
	var cushionLen = 30;

	if (isTopAndBottomRail) {
		// top cushion
		$(canvasId).drawRect( _private_ringTable_createDrawStraightSides_Params({
			x: topLeft_x + theWidth/2, 
			y: topLeft_y + cushionLen/2,
			width: theWidth,
			height: cushionLen,
			data: { isVertical: false, 'canvasSelector': canvasId }				
		}));
		// bottom cushion
		$(canvasId).drawRect( _private_ringTable_createDrawStraightSides_Params({
			x: topLeft_x + theWidth/2, 
			y: (theHeight - cushionLen) + cushionLen/2,
			width: theWidth,
			height: cushionLen,
			data: { isVertical: false, 'canvasSelector': canvasId }
		}));
	} else {
		// left cushion
		$(canvasId).drawRect( _private_ringTable_createDrawStraightSides_Params({
			x: topLeft_x + cushionLen / 2, 
			y: topLeft_y + theHeight / 2,
			width: cushionLen,
			height: theHeight,
			data: { isVertical: true, 'canvasSelector': canvasId }
		}));
		// right cushion
		$(canvasId).drawRect( _private_ringTable_createDrawStraightSides_Params({
			x: topLeft_x + theWidth - cushionLen + (cushionLen/2), 
			y: topLeft_y + theHeight/2,
			width: cushionLen,
			height: theHeight,
			data: { isVertical: true, 'canvasSelector': canvasId }			
		}));
	}
}

/**
 * canvasId - In the form 'canvas' + 'canvas_class'.  For instance, 'canvas.ringTableOne'
 * centerRadial - pivit center of the curve.  Expecting centerRadial.x, centerRadial.y, centerRadial.r 
 * startAngle - In radians, starting angle of what we are drawing at high level.  If it falls outside of this sector's responsibility nothing is drawn.
 * stopAngle  - In radians, starting angle of what we are drawing at high level.  If it falls outside of this sector's responsibility nothing is drawn.
 * responsibilityStartAngle - In radians, the starting angle of this sector.  We are only responsible to draw in this sector.  This is done to provide different gradients across different parts of the table for lighting/perspectives.
 * responsibilityStopAngle  - In radians, the stopping angle of this sector.  We are only responsible to draw in this sector.  This is done to provide different gradients across different parts of the table.
 *
 */
function ringTable_drawCurvedEnd(canvasId, centerRadial, startAngle, stopAngle, responsibilityStartAngle, responsibilityStopAngle) {
	var cushionLen = 30;
	
	var grad = $(canvasId).createGradient({
		x1: centerRadial.x, y1: centerRadial.y,
		x2: centerRadial.x, y2: centerRadial.y,
		r1: centerRadial.r, r2: centerRadial.r - cushionLen,
		c1: 'rgba(255, 0, 0, 0.75)',
		c2: '#000', s2: 0.2,
		c3: '#000', s3: 0.8,
		c4: 'rgba(255, 0, 0, 0.75)'
    });
	
	if (ringTable_isDebuggingTable()) {
		// Draw the circle center for debugging
		$(canvasId).drawArc({
			fillStyle: grad,
			layer: true,
			x: centerRadial.x, y: centerRadial.y,
			radius: 5
		});
	}
	
	var isOurSectorResponsibleToDraw = true;
	if (startAngle > responsibilityStopAngle) {
		isOurSectorResponsibleToDraw = false;
	}
	if (stopAngle < responsibilityStartAngle) {
		isOurSectorResponsibleToDraw = false;
	}
	
	if (isOurSectorResponsibleToDraw) {
		var minStartAngle = Math.max(responsibilityStartAngle, startAngle);
		var maxStopAngle  = Math.min(responsibilityStopAngle, stopAngle);
		$(canvasId).draw({
			layer: true,
			fn: function(ctx) {
				var innerRadius = centerRadial.r - cushionLen;
				if (innerRadius < 0) {
					console.error('cushion length is too large for canvas dimensions');
					innerRadius = 1;
				}
				
				if (ringTable_isDebuggingTable()) {
					ctx.strokeStyle = '#000';
					ctx.strokeWidth = 2;	
				} else {
					ctx.fillStyle = grad;	
				}
				
				ctx.beginPath();
				ctx.arc(centerRadial.x, centerRadial.y, centerRadial.r, minStartAngle, maxStopAngle);
				ctx.lineTo(centerRadial.x - Math.cos(maxStopAngle - Math.PI) * innerRadius, centerRadial.y - Math.sin(maxStopAngle - Math.PI) * innerRadius);  
				ctx.arc(centerRadial.x, centerRadial.y, innerRadius, maxStopAngle, minStartAngle, true);
				ctx.lineTo(centerRadial.x - Math.cos(minStartAngle - Math.PI) * centerRadial.r, centerRadial.y - Math.sin(minStartAngle - Math.PI) * centerRadial.r);
				
				if (ringTable_isDebuggingTable()) {
					ctx.stroke();
				} else {
					ctx.fill();
				}
			}
		});
	}	
} 


			</script>
   </head>
   
   <style>
canvas.canvas1 {
	background: yellow;
}
   </style>
   
   <body>
      <div><canvas id="canvas1" class="canvas1" width="800" height="400"></canvas></div>
      <div><canvas id="canvas2" class="canvas2" width="400" height="800"></canvas></div>
      <div><canvas id="canvas3" class="canvas3" width="800" height="800"></canvas></div>
      <div><canvas id="canvas4" class="canvas4" width="1600" height="300"></canvas></div>
      <div><canvas id="canvas5" class="canvas5" width="300" height="1600"></canvas></div>
   </body>
</html>